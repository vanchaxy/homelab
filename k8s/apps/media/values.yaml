media:
  defaultPodOptions:
    automountServiceAccountToken: false
    securityContext:
      fsGroup: 568
      fsGroupChangePolicy: "OnRootMismatch"
      runAsUser: 0
      runAsGroup: 0

  controllers:
    qbittorrent:
      containers:
        main:
          image:
            repository: linuxserver/qbittorrent
            tag: 4.6.3
          env:
            PUID: 568
            PGID: 568
            TZ: Etc/UTC
            WEBUI_PORT: 8081
          resources:
            limits:
              squat.ai/tun: "1"

        gluetun:
          dependsOn: main
          image:
            repository: ghcr.io/qdm12/gluetun
            tag: v3.40.0
          env:
            FIREWALL_INPUT_PORTS: 8081
            VPN_SERVICE_PROVIDER: protonvpn
            VPN_PORT_FORWARDING: on
            VPN_PORT_FORWARDING_UP_COMMAND: >-
              /bin/sh -c 'wget -O- --retry-connrefused --post-data "json={\"listen_port\":{{ `{{PORTS}}` }}}" http://127.0.0.1:8081/api/v2/app/setPreferences 2>&1'
          envFrom:
            - secretRef:
                name: media-secret
          securityContext:
            privileged: true
            capabilities:
              add:
                - NET_ADMIN
          resources:
            limits:
              squat.ai/tun: "1"

    prowlarr:
      containers:
        main:
          image:
            repository: linuxserver/prowlarr
            tag: 1.33.3
          env:
            PUID: 568
            PGID: 568
            TZ: Etc/UTC

    radarr:
      containers:
        main:
          image:
            repository: linuxserver/radarr
            tag: 5.21.1
          env:
            PUID: 568
            PGID: 568
            TZ: Etc/UTC

    sonarr:
      containers:
        main:
          image:
            repository: linuxserver/sonarr
            tag: 4.0.14
          env:
            PUID: 568
            PGID: 568
            TZ: Etc/UTC

  service:
    qbittorrent:
      controller: qbittorrent
      type: ClusterIP
      ports:
        http:
          port: 8081
    prowlarr:
      controller: prowlarr
      type: ClusterIP
      ports:
        http:
          port: 9696
    radarr:
      controller: radarr
      type: ClusterIP
      ports:
        http:
          port: 7878
    sonarr:
      controller: sonarr
      type: ClusterIP
      ports:
        http:
          port: 8989

  ingress:
    main:
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt
        nginx.ingress.kubernetes.io/force-ssl-redirect: 'true'
      hosts:
        - host: &qbittorrent-host qbittorrent.ivanchenko.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: qbittorrent
                port: http
        - host: &prowlarr-host prowlarr.ivanchenko.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: prowlarr
                port: http
        - host: &radarr-host radarr.ivanchenko.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: radarr
                port: http
        - host: &sonarr-host sonarr.ivanchenko.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: sonarr
                port: http
      tls:
        - secretName: main-tls
          hosts:
            - *qbittorrent-host
            - *prowlarr-host
            - *radarr-host
            - *sonarr-host

  persistence:
    config:
      storageClass: longhorn-ssd
      size: 1Gi
      accessMode: ReadWriteMany
      advancedMounts:
        qbittorrent:
          main:
            - path: /config
              subPath: qbittorrent-config
        prowlarr:
          main:
            - path: /config
              subPath: prowlarr-config
        radarr:
          main:
            - path: /config
              subPath: radarr-config
        sonarr:
          main:
            - path: /config
              subPath: sonarr-config
    data:
      storageClass: longhorn-hdd
      size: 1Ti
      accessMode: ReadWriteMany
      advancedMounts:
        qbittorrent:
          main:
            - path: /data/downloads
              subPath: data/downloads
        radarr:
          main:
            - path: /data
              subPath: data
        sonarr:
          main:
            - path: /data
              subPath: data
